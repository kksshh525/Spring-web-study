## 연관관계 매핑 기초

> 객체는 참조를 사용해서 관계를 맺고 테이블은 외래 키를 사용해서 관계를 맺는다.

1. 방향
    1. 객체에서 방향에서는 단방향, 양방향이 있다
    2. 테이블은 항상 양방향 관계 이다
2. 다중성
    1. N:1 , 1:N, N:M 다중성
3. 연관관계의 주인
    1. *객체를 양방향 연관관계로 만들려면 연관관께의 주인을 정해야 한다*  
    
### 단방향 연관관계

ex) 회원 팀 // N:1관계

[code link](./unidirectional)

객체 : 회원 -> 팀 단방향 ( 회원읜 Team필드로만 참조 가능, 정확히는 다른 단방향 관계 2개로 정의될 수도 있다)
테이블 : 회원 <> 팀 양방향 (둘다 Team key로 조인해서 조회 가능)

### 양방향 연관관계

[code line](./Bi_directional)

양방향은 객체에서 단방향두개의 연관과계를 같는다.
태이블은 외래 키 하나로 두 테이블의 연관관계를 관리
엔터티를 양방향으로 매ㅣㅇ하면 회원 -> 팀, 팀 -> 회원 두 곳에서 참조한다.
따라서 객체의 연관관계를 관리하는 포인트는 2곳으로 늘어난다.

-> 이러한 차이로 인해 JPA에서는 두 개개체의 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야하는데

양방향 매핑의 규칙: 연관관계 주인

두 연관관계중하나를 연관관계의 주인으로 정해야 한다.
연관관계의 주인만이 *연관관계와 매핑되고 외래키를 관리 할 수 있다* 
반면에 주인이 아닌 쪽은 읽기만 할 수 있다. 

**연관관계의 주인으로 정할지는 mappedBy 속성을 사용하면 된다**

1. 주인은 mappedBy속성을 사용하지 않는다.
2. 주인이 아니면 mappedBy속성을 사용해서 속성의 값으로 연관관계의 주인을 지정해야한다.

어떤것을 연관관계의 주인으로 정해야 하나?

1. "외래 키 관리자를 선택해야 하는 것이다"

테이블에 외래 키가 있는곳으로 정해야 한다. 여기서는 회원 테이블이 "외래키"(team_id)를 가지고 있으므로
Member.team이 주인이 된다. (비지니스 로직 중요도는 배재해야한다!)

> 데이터 베이스 테이블의 다대일, 일대다 관계에서는 항상 다쪽이 외래키를 가진다. 다쪽인 ManyToOne은 항상 연관
관계를의 주인이 되므로 mappedBy를 설정할 수 없다.

%주의

주인이 아닌곳에만 참조 값을 입력하면 안된다!

객체 관점에서는 양쪽방향에 모든 값을 입력해주는 것이 가장 안전하다.
양쪽 방향 모두 값을 입력하지 않으면 JPA를 사용하지 않는 순순한 객체 상태에서는 심각한 문제가 발생할 수 있다.


### 정리
1. 단방향 매핑만으로 테이블과 객체의 연관관계 매핑은 이미 완료
2. 단방향을 양방향으로 만들면 반대방향으로 객체 그래프 탐색 기능이 추가 된다.
3. 양방향 연관관계를 매핑하려면 객체에서 양쪽 방향을 모두 관리해야 한다.
